// src/pages/ResetPassword.jsx
import { useState } from "react";
import { supabase } from "../lib/supabaseClient";
import { useNavigate } from "react-router-dom";

export default function ResetPassword() {
  const [pw, setPw] = useState("");
  const [msg, setMsg] = useState("");
  const navigate = useNavigate();

  async function onReset(e){
    e.preventDefault();
    const urlParams = new URLSearchParams(window.location.search);
    const accessToken = urlParams.get("access_token") || urlParams.get("token"); // depends on provider
    if (!accessToken) {
      setMsg("Reset token ontbreekt in URL");
      return;
    }
    const { error } = await supabase.auth.updateUser({ password: pw }, {accessToken});
    if (error) setMsg(error.message);
    else {
      setMsg("Wachtwoord gewijzigd, je wordt doorgestuurd...");
      setTimeout(()=> navigate("/login"), 1500);
    }
  }

  return (
    <div className="p-6 max-w-md mx-auto">
      <h1 className="text-xl font-bold mb-4">Nieuw wachtwoord</h1>
      <form onSubmit={onReset} className="flex flex-col gap-3">
        <input type="password" className="border p-2" placeholder="Nieuw wachtwoord" value={pw} onChange={e=>setPw(e.target.value)} />
        <button className="bg-green-600 text-white p-2 rounded">Wijzig wachtwoord</button>
      </form>
      {msg && <div className="mt-3 text-sm">{msg}</div>}
    </div>
  );
}
